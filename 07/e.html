<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Independent Failure · Unfiltered</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='website'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Unfiltered
</a>
<div class="version-number">
0.10.0-M3
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../01.html" class="page">Try Unfiltered</a></li>
  <li><a href="../02.html" class="page">Plans and Intents</a></li>
  <li><a href="../03.html" class="page">Bindings and Servers</a></li>
  <li><a href="../04.html" class="page">Project Setup</a></li>
  <li><a href="../05.html" class="page">Community</a></li>
  <li><a href="../06/00.html" class="page">Matching and Responding</a>
  <ul>
    <li><a href="../06/a.html" class="page">Request Matchers</a></li>
    <li><a href="../06/b.html" class="page">Within the Parameters</a></li>
    <li><a href="../06/c.html" class="page">Response Functions</a></li>
    <li><a href="../06/d.html" class="page">Silly Store</a></li>
  </ul></li>
  <li><a href="../07/00.html" class="page">Directives and Validation</a>
  <ul>
    <li><a href="../07/a.html" class="page">Directive Intent</a></li>
    <li><a href="../07/b.html" class="page">Parameters as Directives</a></li>
    <li><a href="../07/c.html" class="page">Interpreter Reuse and Implicits</a></li>
    <li><a href="../07/d.html" class="page">Required Parameters</a></li>
    <li><a href="../07/e.html" class="active page">Independent Failure</a></li>
    <li><a href="../07/f.html" class="page">Interpreters of Your Own Design</a></li>
    <li><a href="../07/g.html" class="page">Let&rsquo;s wrap this up, Ada</a></li>
  </ul></li>
  <li><a href="../08/00.html" class="page">Application Structure</a>
  <ul>
    <li><a href="../08/a.html" class="page">Planning for Any-thing</a></li>
    <li><a href="../08/b.html" class="page">Just Kitting</a></li>
  </ul></li>
  <li><a href="../09/00.html" class="page">Identification and Cookies</a>
  <ul>
    <li><a href="../09/a.html" class="page">Who&rsquo;s Who</a></li>
    <li><a href="../09/b.html" class="page">Remembrance of Things Past</a></li>
  </ul></li>
  <li><a href="../10/00.html" class="page">Netty Plans</a>
  <ul>
    <li><a href="../10/a.html" class="page">Trying Netty</a></li>
    <li><a href="../10/b.html" class="page">Execution and Exceptions</a></li>
    <li><a href="../10/c.html" class="page">Chunked Requests</a></li>
    <li><a href="../10/d.html" class="page">Going Asynchronous</a></li>
    <li><a href="../10/e.html" class="page">Asyncrazy Temperature Server</a></li>
  </ul></li>
  <li><a href="../11.html" class="page">Jetty Extras</a></li>
  <li><a href="../12.html" class="page">ScalaTest</a></li>
  <li><a href="../99.html" class="page">Who&rsquo;s Using Unfiltered?</a></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">Unfiltered</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>Unfiltered
</a>
<div class="version-number">
0.10.0-M3
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../01.html" class="page">Try Unfiltered</a></li>
  <li><a href="../02.html" class="page">Plans and Intents</a></li>
  <li><a href="../03.html" class="page">Bindings and Servers</a></li>
  <li><a href="../04.html" class="page">Project Setup</a></li>
  <li><a href="../05.html" class="page">Community</a></li>
  <li><a href="../06/00.html" class="page">Matching and Responding</a>
  <ul>
    <li><a href="../06/a.html" class="page">Request Matchers</a></li>
    <li><a href="../06/b.html" class="page">Within the Parameters</a></li>
    <li><a href="../06/c.html" class="page">Response Functions</a></li>
    <li><a href="../06/d.html" class="page">Silly Store</a></li>
  </ul></li>
  <li><a href="../07/00.html" class="page">Directives and Validation</a>
  <ul>
    <li><a href="../07/a.html" class="page">Directive Intent</a></li>
    <li><a href="../07/b.html" class="page">Parameters as Directives</a></li>
    <li><a href="../07/c.html" class="page">Interpreter Reuse and Implicits</a></li>
    <li><a href="../07/d.html" class="page">Required Parameters</a></li>
    <li><a href="../07/e.html" class="active page">Independent Failure</a></li>
    <li><a href="../07/f.html" class="page">Interpreters of Your Own Design</a></li>
    <li><a href="../07/g.html" class="page">Let&rsquo;s wrap this up, Ada</a></li>
  </ul></li>
  <li><a href="../08/00.html" class="page">Application Structure</a>
  <ul>
    <li><a href="../08/a.html" class="page">Planning for Any-thing</a></li>
    <li><a href="../08/b.html" class="page">Just Kitting</a></li>
  </ul></li>
  <li><a href="../09/00.html" class="page">Identification and Cookies</a>
  <ul>
    <li><a href="../09/a.html" class="page">Who&rsquo;s Who</a></li>
    <li><a href="../09/b.html" class="page">Remembrance of Things Past</a></li>
  </ul></li>
  <li><a href="../10/00.html" class="page">Netty Plans</a>
  <ul>
    <li><a href="../10/a.html" class="page">Trying Netty</a></li>
    <li><a href="../10/b.html" class="page">Execution and Exceptions</a></li>
    <li><a href="../10/c.html" class="page">Chunked Requests</a></li>
    <li><a href="../10/d.html" class="page">Going Asynchronous</a></li>
    <li><a href="../10/e.html" class="page">Asyncrazy Temperature Server</a></li>
  </ul></li>
  <li><a href="../11.html" class="page">Jetty Extras</a></li>
  <li><a href="../12.html" class="page">ScalaTest</a></li>
  <li><a href="../99.html" class="page">Who&rsquo;s Using Unfiltered?</a></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">Unfiltered</a></li>
  <li><a href="../07/00.html">Directives and Validation</a></li>
  <li>Independent Failure</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h2><a href="#independent-failure" name="independent-failure" class="anchor"><span class="anchor-link"></span></a>Independent Failure</h2>
<p>A request that is mapped through a directive can produce either a failure or success response. Usually, this works the way you want. When a <code>PUT</code> request is received for an endpoint that only supports <code>POST</code>, the service can respond with a <code>405 MethodNotAllowed</code> status without inspecting any request parameters.</p>
<p>But among the request parameters themselves, it may be desirable to respond with multiple error messages when there are multiple parameters in error. This can be accomplished by combining directives into a single directive which knows how to bundle the error responses.</p>
<h3><a href="#normalizing-error-responses" name="normalizing-error-responses" class="anchor"><span class="anchor-link"></span></a>Normalizing Error Responses</h3>
<p>Even if you don&rsquo;t intend to bundle errors right away, it&rsquo;s a good idea to generate error responses in a consistent way. This allows you to factor out the status code generation and to put error messages in context. One way to do this is with a case class.</p>
<pre class="prettyprint"><code class="language-scala">import unfiltered.request._
import unfiltered.response._
import unfiltered.directives._, Directives._

case class OneBadParam(msg: String) extends Responder[Any] {
  def respond(res: HttpResponse[Any]): Unit =
    (BadRequest ~&gt; ResponseString(msg + &quot;\n&quot;))(res)
}</code></pre>
<p>We could use this class with a &ldquo;required&rdquo; function.</p>
<pre class="prettyprint"><code class="language-scala">implicit def required[T] = data.Requiring[T].fail(name =&gt;
  OneBadParam(name + &quot; is missing&quot;)
)</code></pre>
<p>This cuts out a bit of boiler plate, but things get more interesting when we define a smarter case class.</p>
<h3><a href="#joinable-responses" name="joinable-responses" class="anchor"><span class="anchor-link"></span></a>Joinable Responses</h3>
<p>If we want Unfiltered to combine error responses from multiple directives, we need to specify exactly how that should work. This can be done with a simple variation of the case class defined above.</p>
<pre class="prettyprint"><code class="language-scala">case class BadParam(msg: String) extends ResponseJoiner(msg)(
  msgs =&gt;
    BadRequest ~&gt; ResponseString(msgs.mkString(&quot;&quot;,&quot;\n&quot;,&quot;\n&quot;))
)</code></pre>
<p>Instances of this class are still defined for a single error message <code>msg</code>, but they know how to format a response for multiple messages of the same type. This allows the toolkit to combine many BadParam instances into a single error response, using the response function defined on any one of the instances.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The type system guarantees that error messages are of the same type and that any instance can produce a response from them, but it is not guaranteed which instance&rsquo;s error handler will be used to produce the error response. You should use the same case class, or the same error handling function, for all of your response error instances.</p></div>
<p>We can redefine &ldquo;required&rdquo; with this improved error responder.</p>
<pre class="prettyprint"><code class="language-scala">implicit def required[T] = data.Requiring[T].fail(name =&gt;
  BadParam(name + &quot; is missing&quot;)
)</code></pre>
<h3><a href="#joining-and-splitting-directives" name="joining-and-splitting-directives" class="anchor"><span class="anchor-link"></span></a>Joining and Splitting Directives</h3>
<p>Now that we have joinable error responses issued from our required interpreter, we can use the <code>&amp;</code> method of <code>Directive</code> to join them, as well as an unapply method of <code>unfiltered.request.&amp;</code> to split them.</p>
<pre class="prettyprint"><code class="language-scala">import unfiltered.jetty.SocketPortBinding

val binding = SocketPortBinding(host = &quot;localhost&quot;, port = 8080)

unfiltered.jetty.Server.portBinding(binding).plan(
  unfiltered.filter.Planify { Directive.Intent {
    case Path(&quot;/&quot;) =&gt;
      for {
        (a &amp; b &amp; c) &lt;-
          (data.as.Required[String] named &quot;a&quot;) &amp;
          (data.as.Required[String] named &quot;b&quot;) &amp;
          (data.as.Required[String] named &quot;c&quot;)
      } yield ResponseString(
        s&quot;a: $a b: $b c: $c&quot;
      )
  } }
).run()</code></pre>
<p>In a failure case, the errors objects are combined and returned on separate lines. On success, the combined directive produces nested tuples of the success cases which <code>&amp;</code> extracts in the order produced.</p>
<pre class="prettyprint"><code class="language-sh">$ curl http://127.0.0.1:8080/
a is missing
b is missing
c is missing
</code></pre>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/unfiltered/website/tree/master/src/paradox/07/e.md">here</a>.
</div>

<div class="nav-next">
<p><strong>Next:</strong> <a href="../07/f.html">Interpreters of Your Own Design</a></p>
</div>
</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../07/e.html#independent-failure" class="header">Independent Failure</a>
  <ul>
    <li><a href="../07/e.html#normalizing-error-responses" class="header">Normalizing Error Responses</a></li>
    <li><a href="../07/e.html#joinable-responses" class="header">Joinable Responses</a></li>
    <li><a href="../07/e.html#joining-and-splitting-directives" class="header">Joining and Splitting Directives</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2019</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
